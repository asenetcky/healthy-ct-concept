{{< include preamble.Rmd >}}

# Social Factors

> The Social Determinants of Health (SDOH) are the upstream non-health factors
> that “impact a wide range of health, functioning and quality of life outcomes.”
> For public health, this is as preventive as it gets. When considering these
> upstream factors in the work of a public health entity such as the Connecticut
> Department of Public Health (CT DPH), we can more effectively inform the public
> and policymakers so we can all live better lives. As an agency whose mission
> declares that the equal enjoyment of a person’s highest attainable standard of
> health is a human right, we must also examine the conditions that contribute to
> “avoidable differences in health among specific population groups that result
> from cumulative social disadvantages.”[@placeholder2] 
> More specifically, we apply an equity lens to ascertain which populations 
> are being most negatively impacted.[^social-factors-1]

[^social-factors-1]: We can do footnotes that pop up on highlight, and that 
also show up at the bottom of the page! They can include citations too (and 
they can be shortened)[-@placeholder2]

::: {.callout-note}
References can be tracked and managed using BibTeX[^social-factors-2] and then
quarto will convert it into a reference page and link it all through the
document.  It almost feels like magic.  The orginal SHA document was around 400
pages long and it could be hard to find the references and then jump back to the
original spot where the reader left off.  Here the references show up on hover
and clicking on them brings the user to the reference page, which can easily be
opened into another tab, thus reducing alot of friction when interacting with
the SHA.
:::

[^social-factors-2]: BibTeX is a format for storing references that is easy
to convert to many other formats. Check out 
[bibtex.org](https://www.bibtex.org/) for more info.

## Education

Economic factors such as poverty and unemployment can lead
to unhealthy living conditions. Yet education can provide
individuals with foundational knowledge, life skills, and social
and psychological supports to make healthier choices. Therefore,
quality education and higher educational attainment can be a
protective factor that can advance more equitable outcomes[-@placeholder3].
It has been demonstrated that individuals without a high school
diploma have higher incidences of risk behaviors and other
adverse health outcomes; and earn less money, which can limit
access to resources and healthy environments[-@placeholder4].

### Early Education

Experiences and education within the first five years of life can
shape one’s health trajectory across the lifespan. Early education
and care programs can be protective against social and economic
challenges and narrow inequitable gaps in health outcomes.5
Participating in these programs are also associated with higher
educational attainment, better eating habits, increased use of
preventive healthcare services, and lower rates of child injuries,
child abuse/maltreatment, teen pregnancy, depression, use of
tobacco or other drugs, and arrests and incarceration.

As noted in @fig-pct-enroll, the rate of Pre-K enrollment for 4-year old
children in state-funded preschool programs in Connecticut has made sizable
gains over the past 5 years; however, enrollment among 3-year old children has
remained fairly stable over the past decade and thus far peaked at 10% in 2016.

:::{.callout-note collapse="true"}
## Be sure to hover over that figure link

Did you see how the chart pops up on mouse hover?  Pretty cool!
While mostly a fun novelty here, in a 400 page document this can allow authors
to provide rich details and context around their data and narratives.
:::

---

> CONNECTICUT RANKS NINTH IN THE US FOR EARLY EDUCATION
> SPENDING PER CHILD[^social-factors-3]

---

[^social-factors-3]: context for users, and possibly a source.

- Connecticut has three state-funded
pre-kindergarten programs: School Readiness
Program, Child Day Care Contracts, and
Smart Start[^social-factors-3]

- In 2018, 14,585 children were enrolled in state
pre-kindergarten programs[^social-factors-3]

- On average, our state spent $7,612 per child
enrolled; this reflects a 30% drop in average per
child expenditure since 2011[^social-factors-3]

- According to most recent estimates available
(2013–2014 school year), children enrolled
in CT early childhood and pre-kindergarten
programs were:[^social-factors-3]  

  - 50% are non-Hispanic White, 26% are Hispanic/Latino,
15% are non-Hispanic Black or African American, and
5% are non-Hispanic Asian

  - 23% are students with disabilities served under the
 Individuals with Disabilities Education Act
 
  - 2% are English Language Learners (those who speak
English less than “very well;” for more information about
Limited English Proficient section)

[^social-factors-3]: ___Source:___ [@placeholder3].


---

```{r}
#| label: fig-pct-enroll
#| echo: false
#| message: false
#| warning: false
#| fig-cap: Quick Example Plot without CT Colors

library(ggplot2)
library(dplyr)

four_yo <- c(9,10,13,15,14,16,16,11,13,13,13,13,14,23,24,30,30)
three_yo <- c(3,3,2,2,3,4,5,8,7,7,8,6,6,9,10,8.5,9)

prek_enrollment <- 
  dplyr::tibble(
    pct_enroll = c(four_yo, three_yo),
    year = c(2002:2018, 2002:2018),
    age = c(rep("4 year olds", 17), rep("3 year olds", 17))
  )

basic_plot <- 
  ggplot(prek_enrollment, aes(year, pct_enroll)) +
  geom_point(aes(col = age)) +
  geom_line(aes(col = age)) +
  theme_classic() +
  labs(
    title = 
    "Percentage of children enrolled in early childhood and Pre-K programs",
    subtitle = "by age group CT, 2002-2018",
    col = "",
    x = "",
    y = "Percentage of Population Enrolled"
  )

basic_plot

#TODO add guides
#TODO add proper colors
#TODO add source caption
#TODO more years on x axis
#TODO remove y axis line
  
  
  
```


Now the same plot with similiar themeing to the original plot, but now
with CT approved colors and poppin font.

```{r}
#| label: fig-pct-enroll-ct
#| echo: false
#| message: false
#| warning: false
#| fig-cap: "Source: [@placeholder5]"


blue <- list_color_hex_codes$list_ct_primary_colors$primary
orange <- list_color_hex_codes$list_ct_secondary_colors$secondary

basic_plot +
   scale_color_manual(values = c(blue, orange)) +
  theme_ct_vertical() +
  theme_poppins_bold_all() +
  theme(
    text = element_text(size = 20)
    
  )
 

```


### Education Attainment

In an age-adjusted multivariate analysis of the entire US, it was demonstrated
that lack of high school education captured the effect of income inequality in
addition to contributing to increased mortality that is attributed to increased
risk of injury as a result of high-risk occupations, inadequate health insurance
coverage, and unhealthy behaviors like smoking.6

In Connecticut, one in ten residents aged 25 and older have earned less than a
high school degree, which is slightly less than the national proportion
(@fig-pct-wbach). As a state, nearly two in five residents 25 and older earned a
bachelor’s degree and above in 2017, exceeding the national rate.

Fairfield County had the greatest percentage of its residents with at least a
bachelor’s degree (47%) while residents from Windham County experienced the
lowest percentage (24%); unsurprisingly, Fairfield County also has the most
towns — 10 out of 23 — with median household incomes exceeding $125,000.

{{< lipsum 2 >}}

## Neighborhood and Built Environment

### Access to Health Foods

{{< lipsum 1 >}}


```{r}
#| label: fig-pct-wbach
#| echo: false
#| message: false
#| warning: false
#| fig-cap: "___Source:___ [@placeholder6]"

# data

pct_wbach <- 
  dplyr::tibble(
    year = c(rep(2010:2017,2)),
    grp = c(rep("CT", 8), rep("US", 8)),
    pct = c(
      35.5, 36.2, 37.1, 37.2, 38.0, 38.3, 38.6, 38.7,
      28.2, 28.5, 29.1, 29.6, 30.1, 30.6, 31.3, 32.0
    )
  ) |> 
  dplyr::mutate(grp = factor(grp, levels = c("CT", "US")))

db <- list_color_hex_codes$list_ct_primary_colors$primary_shade2
lb <- list_color_hex_codes$list_ct_primary_colors$primary


ggplot(pct_wbach, aes(x = year, y = pct, colour = grp)) +
  geom_point() +
  geom_line() +
  geom_text(
    aes(label = pct),
    nudge_y = 1,
    show.legend = FALSE
  ) +
  scale_y_continuous(
    expand = c(0,6)
  ) +
  scale_x_continuous(n.breaks = 8) +
  scale_color_manual(values = c(lb,db)) +
  theme_ct_vertical() +
  theme_poppins_bold_all() +
  theme(
    title = element_text(size = 8.5),
    legend.direction = "horizontal",
    legend.position = "inside",
    legend.position.inside = c(0.8, 1.0)
  ) +
  labs(
    title = "Percentage of population 25 years and older with a bachelor's degree or higher",
    subtitle = "CT and US, 2010-2017",
    y = "PERCENTAGE OF POPULATION",
    x = "",
    col = ""
  )

```

{{< lipsum 1 >}}

### Food Insecurity

{{< lipsum 3 >}}

Oh man, the numbers don't add up to 100% in the original
picture in the SHA.


```{r}
#| label: fig-pct-edu-attn
#| echo: false
#| message: false
#| warning: false
#| fig-cap: "___Source:___ [@placeholder1]"

# data

grp_levels <- c("CT", "NH White", "Hispanic", "Black", "Asian")
degree_levels <- c("Less than Highschool", "High School diploma or equivalent",
                   "Some college or Associate's degree", "Bachelor's Degree",
                   "Gradute or professional degree")

edu_attn <- 
  tidyr::expand_grid(grp_levels, degree_levels) |> 
  dplyr::tibble(
    pct = c(
      0.096, 0.271, 0.246, 0.214, 0.173,
      0.056, 0.256, 0.249, 0.244, 0.195,
      0.284, 0.329, 0.329, 0.096, 0.065,
      0.125, 0.378, 0.298, 0.120, 0.120,
      0.110, 0.128, 0.117, 0.302, 0.344
    )
  ) |> 
  dplyr::rename(
    grp = grp_levels,
    degree = degree_levels
  ) |> 
  dplyr::mutate(
    grp = factor(grp, levels = grp_levels),
    degree = factor(degree, levels = degree_levels)
  ) |> 
  group_by(grp) |> 
  mutate(
    cum_y = cumsum(pct),
    label_y = cum_y - (pct/2)
  ) |> 
  ungroup() |> 
  mutate(
    label = paste0(pct * 100, "%"),
    color_group = if_else(
      degree == "Gradute or professional degree", 
      "white", 
      "black"
    )
  )

# plot
blues <- 
  list_color_hex_codes$list_ct_primary_colors |> 
  unlist() |> 
  unname()

ggplot(edu_attn, aes(x = grp, y = pct, fill = degree)) +
  geom_col(
    col = "white", 
    position = position_stack(reverse = TRUE)
  ) +
  geom_text(
    aes(
      label = label, 
      y = label_y,
      colour = color_group
    ), 
    size = 2.7,
    show.legend = FALSE
  ) +
  coord_flip() +
  scale_fill_manual(values = blues) +
  scale_color_manual(values = c("white", "black")) +
  theme_ct_horizontal() +
  theme_poppins_bold_all() +
  theme(
    legend.position = "top",
    legend.direction = "horizontal",
    legend.text = element_text(size = 7),
    legend.key.size = unit(5, "mm"),
    axis.text.x = element_blank()
  ) +
  labs(
    x = "",
    y = "PERCENTAGE OF POPULATION",
    fill = ""
  ) +
  guides(
    fill = guide_legend(byrow = TRUE, nrow = 2)
  )


```

